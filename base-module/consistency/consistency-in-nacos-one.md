# Nacos 中的一致性协议（一）

## 写在前面

{% hint style="info" %}
Nacos 在 1.3.0 重新构建了内核，修改内容比较大（我们在这个章节中主要关心下面黑体部分）：

1. nacos-core模块修改
   1. nacos集群节点成员寻址模式的统一管理
   2. **nacos内部事件机制**
   3. **nacos一致性协议层**
2. nacos-config模块修改
   1. 新增内嵌分布式数据存储组件
   2. 内嵌存储与外置存储细分
   3. 内嵌存储简单运维
3. nacos-consistency模块新增
   1. **对于AP协议以及CP协议的统一抽象**
{% endhint %}

前面讲了很多内容实际上都是为了接下来介绍 Nacos 中的一致性协议做准备，简单回顾一下：

* **CAP、一致性协议理论**
* **Protobuf**
* **Hessian**
* **Raft 算法**
* **JRaft 算法：**建议反复阅读蚂蚁金服的 SOFAJRaft 指南，因为 Nacos 就是在它的基础上去实现的

如果不了解前面讲的这些直接去理解 Nacos 的一致性协议抽象的话是非常困难的，尤其是你对 Raft 算法没有概念的情况下。

这一部分内容会拆分为几章来讲，尽可能以小而清晰的篇幅来讲解，因为这一块儿内容可以说是 Nacos 的基石，需要大家花费大量的时间、精力去消化、吸收。

_**注意：由于一致性协议涉及到 core 模块，所以这部分内容会提前讲到 core 模块的源码内容**_

## Nacos 一致性协议抽象









